<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>WikiPathways RDF Schema</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
  <style>
    *{box-sizing:border-box}
    :root{--bg:#fafafa;--card:#fff;--border:#e5e5e5;--muted:#6b7280;--accent:#2563eb}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:#111;line-height:1.5}
    header{text-align:center;padding:40px 20px 24px}
    header h1{margin:0 0 8px;font-size:1.75rem;font-weight:600}
    header p{margin:0;color:var(--muted);font-size:.95rem}
    header p a{color:var(--accent)}
    .hero{max-width:960px;margin:0 auto 32px;padding:0 16px}
    .hero img{width:100%;height:auto;border-radius:8px;border:1px solid var(--border);background:#fff}
    .container{max-width:960px;margin:0 auto;padding:0 16px 48px}
    h2{font-size:1.1rem;font-weight:600;margin:0 0 12px}
    ul.files{list-style:none;padding:0;margin:0;display:grid;gap:8px}
    ul.files li a{display:block;padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:6px;text-decoration:none;color:#111;font-size:.9rem;transition:border-color .15s,box-shadow .15s}
    ul.files li a:hover{border-color:var(--accent);box-shadow:0 2px 8px rgba(37,99,235,.08)}
    ul.files li a code{background:#f3f4f6;padding:2px 6px;border-radius:4px;font-size:.8rem;margin-left:6px;color:var(--muted)}
    .viewer{margin-top:32px}
    .viewer-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .viewer-header span{font-size:.85rem;color:var(--muted)}
    .viewer-header a{font-size:.8rem;color:var(--accent);text-decoration:none}
    pre{margin:0;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:6px;overflow-x:auto;font-size:.85rem}
    footer{text-align:center;padding:24px;font-size:.8rem;color:var(--muted)}
    footer a{color:var(--accent)}
    .hidden{display:none}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>WikiPathways RDF Schema</h1>
    <p>Generated with <a href="https://pypi.org/project/rdfsolve/">rdfsolve</a></p>
  </header>

  <section class="hero">
    <img src="https://raw.githubusercontent.com/jmillanacosta/wikipathways_rdfsolve/main/data/WikiPathways.svg" alt="WikiPathways schema diagram">
  </section>

  <div class="container">
    <h2>Data files</h2>
    <ul id="fileList" class="files">
      <li><em class="muted">Loading…</em></li>
    </ul>

    <div id="viewerSection" class="viewer hidden">
      <div class="viewer-header">
        <span id="viewerTitle">—</span>
        <a id="viewerRaw" href="#" target="_blank" rel="noopener">view raw</a>
      </div>
      <pre><code id="viewerCode" class="hljs"></code></pre>
    </div>
  </div>

  <footer>
    Schema for <a href="https://www.wikipathways.org/">WikiPathways</a> RDF &middot; <a href="https://github.com/jmillanacosta/wikipathways_rdfsolve">GitHub</a>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script>
    const OWNER = 'jmillanacosta';
    const REPO  = 'wikipathways_rdfsolve';
    const PATH  = 'data';
    const BRANCH = 'main';

    const fileList = document.getElementById('fileList');
    const viewerSection = document.getElementById('viewerSection');
    const viewerTitle = document.getElementById('viewerTitle');
    const viewerRaw = document.getElementById('viewerRaw');
    const viewerCode = document.getElementById('viewerCode');

    function ext(name){ return name.split('.').pop().toLowerCase(); }

    function langFor(name){
      const e = ext(name);
      if(e==='ttl') return 'turtle';
      if(e==='yaml'||e==='yml') return 'yaml';
      if(e==='json'||e==='jsonld') return 'json';
      if(e==='csv') return 'plaintext';
      if(e==='svg'||e==='xml') return 'xml';
      return 'plaintext';
    }

    async function fetchTree(path=''){
      const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}?ref=${BRANCH}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('GitHub API error');
      return res.json();
    }

    async function loadFiles(){
      try{
        const items = await fetchTree(PATH);
        const textExts = ['ttl','yaml','yml','json','jsonld','csv','xml'];
        const files = [];
        for(const item of items){
          if(item.type==='file'){
            const e = ext(item.name);
            if(textExts.includes(e)) files.push(item);
          } else if(item.type==='dir'){
            const sub = await fetchTree(item.path);
            for(const s of sub){
              if(s.type==='file' && textExts.includes(ext(s.name))) files.push(s);
            }
          }
        }
        renderList(files);
      }catch(e){
        fileList.innerHTML = `<li style="color:#b91c1c">Failed to load file list</li>`;
      }
    }

    function renderList(files){
      fileList.innerHTML = '';
      files.forEach(f=>{
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = '#';
        a.innerHTML = `${f.path} <code>${ext(f.name)}</code>`;
        a.onclick = ev=>{ ev.preventDefault(); showFile(f); };
        li.appendChild(a);
        fileList.appendChild(li);
      });
    }

    async function showFile(f){
      viewerSection.classList.remove('hidden');
      viewerTitle.textContent = f.path + ' — loading…';
      viewerRaw.href = f.html_url;
      try{
        const res = await fetch(f.download_url);
        const text = await res.text();
        viewerCode.textContent = text;
        viewerCode.className = 'hljs ' + langFor(f.name);
        hljs.highlightElement(viewerCode);
        viewerTitle.textContent = f.path;
      }catch(e){
        viewerCode.textContent = 'Error loading file';
        viewerTitle.textContent = f.path + ' — error';
      }
    }

    loadFiles();
  </script>
</body>
</html>
