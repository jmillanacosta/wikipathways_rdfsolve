<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Data files — viewer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
  <style>
    :root{--bg:#f7f7f7;--panel:#ffffff;--muted:#666;--accent:#2b6cb0}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--bg);color:#111}
    .wrap{display:flex;min-height:100vh}
    nav{width:300px;background:var(--panel);border-right:1px solid #e6e6e6;padding:16px;box-sizing:border-box}
    main{flex:1;padding:16px}
    h1{font-size:16px;margin:0 0 12px}
    input[type=search]{width:100%;padding:8px;margin-bottom:12px;border:1px solid #ddd;border-radius:6px}
    ul.file-list{list-style:none;padding:0;margin:0;max-height:75vh;overflow:auto}
    ul.file-list li{padding:8px 6px;border-radius:6px;cursor:pointer}
    ul.file-list li:hover{background:#f0f8ff}
    a.file-link{color:inherit;text-decoration:none;display:block}
    .meta{font-size:12px;color:var(--muted);margin-bottom:8px}
  pre.hljs{padding:12px;border-radius:6px;background:var(--panel);overflow:auto;max-height:80vh}
  /* viewer containers */
  #viewerContainer{min-height:200px}
  #codeWrapper{display:block}
  #svgContainer{display:none;max-height:80vh;overflow:auto;background:var(--panel);padding:12px;border-radius:6px}
  #svgContainer object{max-width:100%;height:auto;border:0}
    .status{margin-top:8px;color:var(--muted);font-size:13px}
    footer{font-size:12px;color:var(--muted);margin-top:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <nav>
      <h1>Data files</h1>
      <div class="meta">Files from <code>/data</code> — click to view or open the raw file</div>
      <input id="filter" type="search" placeholder="filter files">
      <ul id="files" class="file-list"></ul>
      <footer>Generated with <a href="https://pypi.org/project/rdfsolve/">rdfsolve</a></footer>
    </nav>
    <main>
      <div class="meta" id="selectedInfo">Select a file to view</div>
      <!-- Viewer container: code viewer and svg viewer (only one visible at a time) -->
      <div id="viewerContainer">
  <pre id="codeWrapper"><code id="viewer" class="hljs" aria-live="polite"></code></pre>
  <div id="svgContainer"></div>
      </div>
      <div id="status" class="status"></div>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script>
    // File list derived from repo data folder at build time
    const files = [
      'data/WikiPathways.svg',
      // remote raw github svg (provided)
      'https://raw.githubusercontent.com/jmillanacosta/wikipathways_rdfsolve/refs/heads/main/data/WikiPathways.svg',
      'data/WikiPathways_config/endpoint.yaml',
      'data/WikiPathways_config/model.yaml',
      'data/WikiPathways_config/prefix.yaml',
      'data/WikiPathways_linkml_schema.yaml',
      'data/WikiPathways_schema.csv',
      'data/WikiPathways_schema.jsonld',
      'data/WikiPathways_schema.shacl.ttl',
      'data/WikiPathways_schema.shacl_with_gpml.ttl',
      'data/WikiPathways_void.ttl'
    ];

    const filesEl = document.getElementById('files');
    const viewer = document.getElementById('viewer');
    const status = document.getElementById('status');
    const selectedInfo = document.getElementById('selectedInfo');
    const filter = document.getElementById('filter');

    function basename(path){return path.split('/').pop()}

    function detectLang(name){
      const n = name.toLowerCase();
      if(n.endsWith('.ttl') || n.includes('.shacl')) return 'turtle';
      if(n.endsWith('.json') || n.endsWith('.jsonld')) return 'json';
      if(n.endsWith('.yaml')||n.endsWith('.yml')) return 'yaml';
      if(n.endsWith('.csv')) return 'plaintext';
      if(n.endsWith('.svg')||n.endsWith('.xml')) return 'xml';
      return 'plaintext';
    }

    function setStatus(msg, isError){ status.textContent = msg || ''; status.style.color = isError ? '#b00020' : 'var(--muted)'; }

    function renderList(list){
      filesEl.innerHTML = '';
      list.forEach(f=>{
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.textContent = basename(f);
        a.href = f;
        a.className = 'file-link';
        a.target = '_blank';
        a.rel = 'noopener';
        a.onclick = (ev)=>{ ev.preventDefault(); loadFile(f); };
        li.appendChild(a);
        filesEl.appendChild(li);
      });
    }

    async function loadFile(path){
      setStatus('Loading ' + path + '...');
      selectedInfo.textContent = path + ' — loading';
      const codeWrapper = document.getElementById('codeWrapper');
      const svgContainer = document.getElementById('svgContainer');
      try{
        const res = await fetch(path);
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const text = await res.text();
        const lang = detectLang(path);

        // If this is an SVG, render it inline instead of showing source text
        if(path.toLowerCase().endsWith('.svg') || lang === 'xml'){
          // show svg container and embed via <object> (safer than injecting markup)
          codeWrapper.style.display = 'none';
          svgContainer.style.display = 'block';
          // create object element and set data to the path (use absolute URL when provided)
          svgContainer.innerHTML = '';
          const obj = document.createElement('object');
          obj.type = 'image/svg+xml';
          obj.data = path;
          obj.ariaLabel = basename(path);
          svgContainer.appendChild(obj);
          setStatus('Rendered SVG via <object>');
          selectedInfo.textContent = path + ' — ' + basename(path);
          return;
        }

        // Fallback: show source text with highlighting
        svgContainer.style.display = 'none';
        codeWrapper.style.display = 'block';
        viewer.textContent = text;
        viewer.className = 'hljs ' + lang;
        // Basic linting for JSON files
        if(lang === 'json'){
          try{ JSON.parse(text); setStatus('JSON: valid'); }
          catch(e){ setStatus('JSON parse error: ' + e.message, true); }
        } else {
          setStatus('Highlighted as ' + lang);
        }
        selectedInfo.textContent = path + ' — ' + basename(path);
        hljs.highlightElement(viewer);
      }catch(e){
        viewer.textContent = '';
        codeWrapper.style.display = 'block';
        svgContainer.style.display = 'none';
        setStatus('Error loading file: ' + e.message, true);
        selectedInfo.textContent = 'Error';
      }
    }

    // initial render
    renderList(files);

    // filter
    filter.addEventListener('input', ()=>{
      const q = filter.value.trim().toLowerCase();
      renderList(files.filter(f=>f.toLowerCase().includes(q) || basename(f).toLowerCase().includes(q)));
    });

    // accessibility: load first textual file
    (function tryOpen(){
      const first = files.find(f=>!f.endsWith('/'));
      if(first) loadFile(first);
    })();
  </script>
</body>
</html>
